<!DOCTYPE html>
<html>
    <head>
        <title>Redirecting...</title>
        <script>
            window.onload = () => {
                const queryParams = new URLSearchParams(window.location.search);
                const hashParams = new URLSearchParams(window.location.hash.slice(1));
                const hash = window.location.hash.slice(1);

                const type = queryParams.get('type') || hashParams.get('type');
                const source = queryParams.get('source');
                const accessToken = hashParams.get('access_token');

                if (source === 'email_update') {
                    window.location.href = '/email-change-confirmed.html' + window.location.hash + window.location.search;
                } else if (type === 'email_change') {
                    window.location.href = '/verify.html' + window.location.hash + window.location.search;
                } else if (type === 'recovery') {
                    window.location.href = '/reset-password.html' + window.location.hash + window.location.search;
                } else if (accessToken) {
                    // OAuth login success, forward to the correct web app
                    const target = window.location.hostname === 'localhost' ? `http://localhost:3000/auth/callback#${hash}` : `https://web.scrutiny.app/auth/callback#${hash}`;
                    window.location.href = target;
                } else {
                    document.body.innerHTML = '<h2>Unsupported action type.</h2>';
                }
            };
        </script>
    </head>
    <body>
        <h2>Redirecting...</h2>
    </body>
</html>
